
///for popular
SELECT DISTINCT pm.product_model_id, (
  SELECT COUNT(om.order_model_id) 
  FROM order_model as om
  INNER JOIN model_sizes as ms ON om.model_size_id = ms.model_size_id
  INNER JOIN product_model as pm1 ON ms.product_model_id = pm1.product_model_id
  WHERE pm1.product_model_id = pm.product_model_id
) AS order_count
FROM product_model pm
INNER JOIN product p ON pm.product_id = p.product_id
INNER JOIN brand b on p.brand_id = b.brand_id
INNER JOIN category ct ON p.category_id = ct.category_id
inner join model_sizes ms on ms.product_model_id = pm.product_model_id
inner join sizes sz on ms.size_id = sz.size_id
inner join product_model_img as pimg on pimg.product_model_id = pm.product_model_id
inner join order_model as om ON ms.model_size_id = om.model_size_id
ORDER BY order_count DESC
LIMIT 28
;


//get similar products
SELECT p.product_id as p_id, p.title as p_title,
	b.brand_id as b_id, b.title as b_title, b.slug as b_slug, ct.category_id as ct_id, ct.title as ct_title,
	ct.short_title as ct_short_title, ct.slug as ct_slug,
	pm.product_model_id as model_id, pm.slug as m_slug, pm.article as m_article, pm.price as model_price, pm.discount as model_discount,
	pm.main_image_path as pm_main_img,
	pimg.product_img_id as pimg_id, pimg.product_model_id as pimg_model_id, pimg.img_path as pimg_img_path, 
	sz.size_id as size_id, sz.size_value as size_value, ms.literal_size as literal_size,
	ms.product_model_id as ms_pm_id, ms.in_stock as ms_in_stock,
	ms.model_size_id as ms_m_sz_id
	FROM product p INNER JOIN category ct ON p.category_id = ct.category_id 
	INNER JOIN brand b on p.brand_id = b.brand_id
	INNER JOIN product_model pm ON pm.product_id = p.product_id
	inner join model_sizes ms on ms.product_model_id = pm.product_model_id
	inner join sizes sz on ms.size_id = sz.size_id
	inner join product_model_img as pimg on pimg.product_model_id = pm.product_model_id
	WHERE b.brand_id = 3 LIMIT 12;


SELECT p.product_id as p_id, p.title as p_title,
	b.brand_id as b_id, b.title as b_title, b.slug as b_slug, ct.category_id as ct_id, ct.title as ct_title,
	ct.short_title as ct_short_title, ct.slug as ct_slug,
	pm.product_model_id as model_id, pm.slug as m_slug, pm.article as m_article, pm.price as model_price, pm.discount as model_discount,
	pm.main_image_path as pm_main_img,
	pimg.product_img_id as pimg_id, pimg.product_model_id as pimg_model_id, pimg.img_path as pimg_img_path, 
	sz.size_id as size_id, sz.size_value as size_value, ms.literal_size as literal_size,
	ms.product_model_id as ms_pm_id, ms.in_stock as ms_in_stock,
	ms.model_size_id as ms_m_sz_id
	FROM product p INNER JOIN category ct ON p.category_id = ct.category_id 
	INNER JOIN brand b on p.brand_id = b.brand_id
	INNER JOIN product_model pm ON pm.product_id = p.product_id
	inner join model_sizes ms on ms.product_model_id = pm.product_model_id
	inner join sizes sz on ms.size_id = sz.size_id
	inner join product_model_img as pimg on pimg.product_model_id = pm.product_model_id
	WHERE ct.category_id = $1 LIMIT 12;


//add to catalog maybe
(select round(avg(f.rate), 2) from feedback as f
inner join product_model fpm on fpm.product_model_id = f.product_model_id
where fpm.product_model_id = pm.product_model_id
) as avg_rate,
(select count(f.feedback_id) from feedback as f
inner join product_model fpm on fpm.product_model_id = f.product_model_id
where fpm.product_model_id = pm.product_model_id
)as rate_count